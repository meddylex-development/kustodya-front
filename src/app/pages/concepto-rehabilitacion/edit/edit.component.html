<div class="row" accent="danger" size="tiny" [nbSpinner]="submitted" nbSpinnerStatus="info" nbSpinnerSize="large" nbSpinnerMessage="{{textLoading}}">
  <div class="col-md-12">

    <nb-flip-card [showToggleButton]="false" [flipped]="flipped">
      <nb-card-front>
        <nb-card>
          <nb-card-header>
            <div class="row m-0 p-0">
              <div class="col text-left">
                <button type="button" (click)="fnReturnPage()" class="btn btn-link text-info cursor-pointer">
                  <i class="fas fa-arrow-left"></i>&nbsp;{{ 'Regresar' | titlecase }}
                </button>
              </div>
              <div class="col-6 text-center">
                <h3 style="margin-top: 6px;">Generaci&oacute;n concepto rehabilitaci&oacute;n</h3>
              </div>
              <div class="col text-right">
                &nbsp;
              </div>
            </div> 
          </nb-card-header>
          <nb-card-body>
            <div class="row" *ngIf="false">
              <div class="col-md-12">
                <!-- ********** START - Datos del paciente ********** -->
                <div class="mb-2 animated fadeIn" *ngIf="patientData">
                  <div class="card mt-3 mb-3 border-info">
                    <div class="cursor-pointer card-header bg-info" (click)="fnShowContent('content-patient-info')" style="color: #FFF; display: flex; justify-content: space-between;">
                      <span>
                        <i class="fas fa-user-injured" style="color: #fff; font-size: 20px;"></i>&nbsp;&nbsp;
                        <h5 class="d-inline-block" style="color: #FFF; margin: 0;">DATOS DEL PACIENTE</h5>
                      </span>
                      <span class="cursor-pointer btn-show-patient-info">
                        <i class="fas fa-chevron-circle-down" style="color: #fff; font-size: 20px;"></i>
                      </span>
                    </div>
                    <div class="card-body content-patient-info" style="display: block;">
                      <div class="row">
                        <div class="col">
                          <div style="margin-bottom: 0.5rem;">
                            <span><i class="fas fa-user"></i>&nbsp;Primer&nbsp;nombre:&nbsp;</span><br>
                            <h6 style="color: #000;" *ngIf="patientData?.primerNombre">{{ (patientData?.primerNombre | titlecase) }}</h6>
                            <small *ngIf="!patientData?.primerNombre">No registra dato</small>
                          </div>
                          <div style="margin-bottom: 0.5rem;">
                            <span><i class="far fa-id-card"></i>&nbsp;Tipo de documento:</span><br>
                            <h6 style="color: #000;" *ngIf="patientData?.tipoDoc">{{ (patientData?.tipoDoc | titlecase) }}</h6>
                            <small *ngIf="!patientData?.tipoDoc">No registra dato</small>
                          </div>
                          <div style="margin-bottom: 0.5rem;">
                            <span><i class="far fa-calendar-alt"></i>&nbsp;Edad:</span><br>
                            <h6 style="color: #000;" *ngIf="patientData?.edad">{{ patientData?.edad + ' años' }}</h6>
                            <small *ngIf="!patientData?.edad">No registra dato</small>
                          </div>
                          <div style="margin-bottom: 0.5rem;">
                            <span><i class="fas fa-map-pin"></i>&nbsp;Pa&iacute;s:</span><br>
                            <h6 style="color: #000;" *ngIf="patientData?.nombrePais">{{ patientData?.nombrePais | titlecase }}</h6>
                            <small *ngIf="!patientData?.nombrePais">No registra dato</small>
                          </div>
                        </div>
                        <div class="col">
                          <div style="margin-bottom: 0.5rem;">
                            <span><i class="fas fa-user"></i>&nbsp;Segundo&nbsp;nombre:&nbsp;</span><br>
                            <h6 style="color: #000;" *ngIf="patientData?.segundoNombre">{{ (patientData?.segundoNombre | titlecase) }}</h6>
                            <small *ngIf="!patientData?.segundoNombre">No registra dato</small>
                          </div>
                          <div style="margin-bottom: 0.5rem;">
                            <span><i class="far fa-id-card"></i>&nbsp;N&uacute;mero de documento:</span><br>
                            <h6 style="color: #000;" *ngIf="patientData?.numeroDocumento">{{ patientData?.numeroDocumento }}</h6>
                            <small *ngIf="!patientData?.numeroDocumento">No registra dato</small>
                          </div>
                          <div style="margin-bottom: 0.5rem;">
                            <span><i class="fas fa-at"></i>&nbsp;Correo electr&oacute;nico:</span><br>
                            <h6 style="color: #000;" *ngIf="patientData?.email">{{ patientData?.email }}</h6>
                            <small *ngIf="!patientData?.email">No registra dato</small>
                          </div>
                          <div style="margin-bottom: 0.5rem;">
                            <span><i class="fas fa-map-pin"></i>&nbsp;Depatamento:</span><br>
                            <h6 style="color: #000;" *ngIf="patientData?.nombreDepartamento">{{ patientData?.nombreDepartamento | titlecase }}</h6>
                            <small *ngIf="!patientData?.nombreDepartamento">No registra dato</small>
                          </div>
                        </div>
                        <div class="col">
                          <div style="margin-bottom: 0.5rem;">
                            <span><i class="fas fa-user"></i>&nbsp;Primer&nbsp;apellido:&nbsp;</span><br>
                            <h6 style="color: #000;" *ngIf="patientData?.primerApellido">{{ (patientData?.primerApellido | titlecase) }}</h6>
                            <small *ngIf="!patientData?.primerApellido">No registra dato</small>
                          </div>
                          <div style="margin-bottom: 0.5rem;">
                            <span><i class="far fa-calendar-alt"></i>&nbsp;Fecha de nacimiento:</span><br>
                            <h6 style="color: #000;" *ngIf="patientData?.fechaNacimiento">{{ patientData?.fechaNacimiento | date:'mediumDate' }}</h6>
                            <small *ngIf="!patientData?.fechaNacimiento">No registra dato</small>
                          </div>
                          <div style="margin-bottom: 0.5rem;">
                            <span><i class="fas fa-map-marker"></i>&nbsp;Direcci&oacute;n:</span><br>
                            <h6 style="color: #000;" *ngIf="patientData?.direccion">{{ patientData?.direccion }}</h6>
                            <small *ngIf="!patientData?.direccion">No registra dato</small>
                          </div>
                          <div style="margin-bottom: 0.5rem;">
                            <span><i class="fas fa-map-pin"></i>&nbsp;Ciudad:</span><br>
                            <h6 style="color: #000;" *ngIf="patientData?.nombreMunicipio">{{ patientData?.nombreMunicipio | titlecase }}</h6>
                            <small *ngIf="!patientData?.nombreMunicipio">No registra dato</small>
                          </div>
                        </div>
                        <div class="col">
                          <div style="margin-bottom: 0.5rem;">
                            <span><i class="fas fa-user"></i>&nbsp;Segundo&nbsp;apellido:&nbsp;</span><br>
                            <h6 style="color: #000;"*ngIf="patientData?.segundoApellido">{{ (patientData?.segundoApellido | titlecase) }}</h6>
                            <small *ngIf="!patientData?.segundoApellido">No registra dato</small>
                          </div>
                          <div style="margin-bottom: 0.5rem;">
                            <span><i class="fas fa-venus-mars"></i>&nbsp;G&eacute;nero:</span><br>
                            <h6 style="color: #000;"*ngIf="patientData?.genero">{{ (patientData?.genero | titlecase) }}</h6>
                            <small *ngIf="!patientData?.genero">No registra dato</small>
                          </div>
                          <div style="margin-bottom: 0.5rem;">
                            <span><i class="fas fa-phone-square-alt"></i>&nbsp;T&eacute;lefono:</span><br>
                            <h6 style="color: #000;"*ngIf="patientData?.telefono">{{ patientData?.telefono }}</h6>
                            <small *ngIf="!patientData?.telefono">No registra dato</small>
                          </div>
                        </div>
                      </div>
                  
                    </div>
                  </div>
                </div>
                <!-- *********** END - Datos del paciente *********** -->
                <!-- ********** START - Alerta de usuario sin permiso ********** -->
                <div style="background-color: #fff; padding: 0; border-radius: 6px;" *ngIf="flagShowAlertUser">
                  <div class="alert alert-danger m-0" role="alert">
                    <i class="fas fa-exclamation-circle"></i>&nbsp;
                    Este perfil no tiene permisos para generar incapacidades.
                    <strong 
                      (click)="showModalHelp('Alerta', 'Perfil no autorizado', 'Perfil no autorizado', 'Este perfil no cuenta con los permisos suficientes para la generaci{on y consulta de incapacidades.')"
                      class="cursor-pointer" 
                      style="font-weight: 900; text-decoration: underline;">{{ (dataUserSpecialist) ? dataUserSpecialist['detalles'][0]['ocupacion'] : '' }}</strong>
                      <!-- <small>Fuernte <strong>e-Rethus</strong></small> -->
                  </div>
                </div>
                <!-- *********** END - Alerta de usuario sin permiso *********** -->
              </div>
            </div>

            <!-- ********** START - Datos del paciente ********** -->
            <div class="row">
              <div class="col-6">
                <nb-user 
                  size="large"
                  [name]="(patientFullName) | titlecase"
                  [title]="patientData?.numeroDocumento"
                  badgeText=""
                  badgeStatus="warning"
                  color="info" 
                  shape="rectangle" 
                  picture=""
                  badgePosition="bottom right">
                </nb-user>
              </div>
              <div class="col-6 text-right">
                <small style="color: #949494;">Prioridad: </small>
                <span style="width: 60px;" class="badge rounded-pill text-light cursor-pointer badge-state-1" tooltip="Prioridad: {{ (dataConceptForm?.Prioridad == 1) ? 'Baja' : (dataConceptForm?.Prioridad == 2) ? 'Media' : (dataConceptForm?.Prioridad == 3) ? 'Alta' : 'Sin prioridad' }}" placement="top" container="body" 
                  [ngClass]="{
                    'badge-state-0': !dataConceptForm?.Prioridad, 
                    'badge-state-1': dataConceptForm?.Prioridad == 1, 
                    'badge-state-6': dataConceptForm?.Prioridad == 2, 
                    'badge-state-5': dataConceptForm?.Prioridad == 3
                  }">
                  <!-- <i class="fas fa-exclamation"></i>&nbsp; -->
                  {{ (dataConceptForm?.Prioridad == 1) ? 'Baja' : (dataConceptForm?.Prioridad == 2) ? 'Media' : (dataConceptForm?.Prioridad == 3) ? 'Alta' : 'Sin prioridad' }}
                </span>
                &nbsp;&nbsp;&nbsp;&nbsp;
                <small style="color: #949494;">Fecha asignaci&oacute;n: </small>
                <small style="font-weight: 600;">{{ dataConceptForm?.FechaAsignacion | date:"fullDate" }}</small>
              </div>
              <div class="col-12" *ngIf="false">
                <div class="mt-3">
                  <small>Asunto: </small>&nbsp;<h5>{{ 'Concepto de rehabilitacion' }}</h5>
                </div>
                <div>
                  <small><i class="fas fa-paperclip"></i>&nbsp;Archivos adjuntos: </small>&nbsp;
                  <span *ngFor="let item of [1,1,1,1,1,1]; let i = index;" class="mr-2 badge rounded-pill text-light cursor-pointer badge-state-1" tooltip="{{ item?.nombreArchivo }}" placement="top" container="body">
                    <i class="fas fa-file-alt"></i>&nbsp;
                    <!-- {{ item?.nombreArchivo }}&nbsp; -->
                    {{ 'Archivo ' + i }}
                  </span>
                </div>
              </div>
            </div>
            <!-- *********** END - Datos del paciente *********** -->
            
            <!-- ********** START - Porcentaje completado concepto ********** -->
            <div class="row mt-2 mb-4" style="background-color: #fff; padding: 0; border-radius: 6px;">
              <div class="col">
                <label for="input-patientDiagnostics">
                  <p class="m-0 f-roboto text-secondary" style="color: #949494;">
                    <i class="fas fa-notes-medical"></i>&nbsp;Concepto de rehabilitaci&oacute;n completado en un: <strong>{{percentajeConcept || 0}}%</strong>&nbsp;
                    <!-- <span class="text-danger cursor-pointer" tooltip="Campo obligatorio" placement="top" container="body">*</span> -->
                  </p>
                </label>
                <div class="progress" style="height: 0.5rem;">
                  <div class="progress-bar progress-bar-striped" role="progressbar" [ngClass]="{'bg-danger': (percentajeConcept <= 30), 'bg-warning': (percentajeConcept >= 31 && percentajeConcept <= 95), 'bg-success': (percentajeConcept > 95)}"  [ngStyle]="{'width': (percentajeConcept) + '%'}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
              </div>
            </div>
            <!-- *********** END - Porcentaje completado concepto *********** -->
            
            <div class="row">
              <div class="col">

                <nb-stepper id="stepper-crhb" #stepper orientation="horizontal" disableStepNavigation>

                  <nb-step label="Diagnostico">
                    <form #diagnosticoForm="ngForm" class="step-container">
                      <!-- ********** START - Diagnostico paciente ********** -->
                      <div class="row">
                        <div class="mt-2 mb-2 col-12">
                          <div class="card">
                            <div class="card-header">
                              Diagnostico paciente
                            </div>
                            <div class="card-body">
                              <div class="content-form-add-diagnostics" style="display: none;" *ngIf="true">
                                <div class="row pb-2" style="border-bottom: solid 1px #d8d8d8;border-radius: 15px;box-shadow: 3px 17px 27px -18px;">
                                  <!-- ********** START - Diagnostico CIE10 ********** -->
                                  <div class="col-4">
                                    <div class="form-group">
                                      <label for="input-patientDiagnostics">
                                        <h5 class="m-0">
                                          <i class="fas fa-notes-medical"></i>&nbsp;Diagn&oacute;stico (CIE10):&nbsp;
                                          <span class="text-danger cursor-pointer" tooltip="Campo obligatorio" placement="top" container="body">*</span>
                                        </h5>
                                      </label>
                                      <ng-select 
                                        [items]="collectionPatientDiagnostics" 
                                        [virtualScroll]="true" 
                                        [multiple]="false" 
                                        [closeOnSelect]="true"
                                        [searchable]="true" 
                                        [hideSelected]="true" 
                                        bindLabel="tFullDescripcion"
                                        id="input-patientDiagnostics" 
                                        name="patientDiagnostics" 
                                        #patientDiagnostics="ngModel"
                                        [(ngModel)]="selectPatientDiagnostics"
                                        [ngModelOptions]="{standalone: true}" 
                                        (change)="validDiagnostic = false;" 
                                        placeholder="Seleccione diagnóstico del paciente" 
                                        required 
                                        [disabled]="false" 
                                        [clearable]="true">
                                        <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                                          <div class="ng-value" *ngFor="let item of items | slice:0:2" style="padding: 8px; border-radius: 10px;">
                                              <span class="ng-value-label">{{item.tFullDescripcion}}</span>
                                              <span class="ng-value-icon right" (click)="clear(item)" aria-hidden="true">×</span>
                                          </div>
                                          <div class="ng-value" *ngIf="items.length > 2">
                                              <span class="ng-value-label">{{items.length - 2}} m&aacute;s...</span>
                                          </div>
                                        </ng-template>
                                      </ng-select>
        
                                      <!-- <div class="mt-3" *ngIf="patientData?.diagnostic?.patientDiagnostics?.tCie10">
                                        <label for="input-patientDiagnostics">
                                          <small class="m-0 cursor-pointer">
                                            <i class="fas fa-chevron-right"></i>&nbsp;Diagn&oacute;stico seleccionado:&nbsp;
                                          </small>
                                        </label>
                                        <div class="listPatientDiagnostics m-2" style="display: none;">
                                          <div class="m-2 d-flex justify-content-between" style="border-radius: 5px; font-size: .9em; background-color: #ebf5ff !important; color: #000; padding: 5px; font-weight: 400;">
                                            <span class="text-truncate d-inline-block" style="max-width: 95%;">{{ patientData?.diagnostic?.patientDiagnostics?.tFullDescripcion }}</span>
                                            <i (click)="fnRemovePatientDiagnostic(patientData.diagnostic.patientDiagnostics)" tooltip="Eliminar síntoma" placement="top" container="body" class="fas fa-times-circle" style="cursor: pointer; color: #f86161; display: inline-block; font-size: 15px;"></i>
                                          </div>
                                        </div>
                                      </div> -->
        
                                    </div>
                                  </div>
                                  <!-- *********** END - Diagnostico CIE10 *********** -->
                                  <!-- ********** START - Etiologia ********** -->
                                  <div class="col-4">
                                    <div class="form-group">
                                      <label for="input-patientEtiology">
                                        <h5 class="m-0">
                                          <i class="fas fa-heartbeat"></i>&nbsp;Etiologia:&nbsp;
                                          <span class="text-danger cursor-pointer" tooltip="Campo obligatorio" placement="top" container="body">*</span>
                                        </h5>
                                      </label>
                                      <ng-select 
                                        [items]="collectionEtiology" 
                                        [virtualScroll]="true" 
                                        [multiple]="false" 
                                        [closeOnSelect]="true"
                                        [searchable]="true" 
                                        [hideSelected]="true" 
                                        bindLabel="tDescripcion"
                                        id="input-patientEtiology" 
                                        name="patientEtiology" 
                                        #patientEtiology="ngModel"
                                        [(ngModel)]="selectPatientEtiology"
                                        [ngModelOptions]="{standalone: true}" 
                                        placeholder="Seleccione etiología diagnóstico"
                                        required 
                                        [disabled]="false" 
                                        [clearable]="true">
                                        <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                                          <div class="ng-value" *ngFor="let item of items | slice:0:2" style="padding: 8px; border-radius: 10px;">
                                              <span class="ng-value-label">{{item.tDescripcion}}</span>
                                              <span class="ng-value-icon right" (click)="clear(item)" aria-hidden="true">×</span>
                                          </div>
                                          <div class="ng-value" *ngIf="items.length > 2">
                                              <span class="ng-value-label">{{items.length - 2}} m&aacute;s...</span>
                                          </div>
                                        </ng-template>
                                      </ng-select>
                                    </div>
                                  </div>
                                  <!-- *********** END - Etiologia *********** -->
                                  <!-- ********** START - Fecha diagnostico ********** -->
                                  <div class="col-3">
                                    <div class="form-group">
                                      <label for="input-patientDiagnosticDate">
                                        <h5 class="m-0">
                                          <i class="far fa-calendar-alt"></i>&nbsp;Fecha diagn&oacute;stico:&nbsp;
                                          <span class="text-danger cursor-pointer" tooltip="Campo obligatorio" placement="top" container="body">*</span>
                                        </h5>
                                      </label>
                                      <input 
                                        class="cursor-pointer"
                                        nbInput
                                        fullWidth 
                                        fieldSize="large"  
                                        type="text" 
                                        [readonly]="true" 
                                        [disabled]="false" 
                                        placeholder="Seleccione fecha diagnóstico"
                                        id="input-patientDiagnosticDate"  
                                        name="patientDiagnosticDate" 
                                        (focus)="patientInputDiagnosticDate = '';"
                                        [(ngModel)]="patientInputDiagnosticDate" 
                                        [ngModelOptions]="{standalone: true}"
                                        [status]="patientDiagnosticDate.dirty ? (patientDiagnosticDate.invalid  ? 'danger' : 'basic') : 'basic'" 
                                        #patientDiagnosticDate="ngModel"
                                        bsDatepicker 
                                        [maxDate]="maxDate"
                                        [bsConfig]="{ dateInputFormat: 'DD-MM-YYYY', containerClass: 'theme-blue' }">
                                        <!-- <i class="far fa-calendar-alt cursor-pointer" style="position: absolute; right: 25px; font-size: 2rem; color: #007bff;"></i> -->
                                    </div>
                                  </div>
                                  <!-- *********** END - Fecha diagnostico *********** -->
                                  <div class="col-1 p-0 d-flex align-items-center">
                                    <span tooltip="Agregar nuevo diagnóstico" placement="top" container="body">
                                      <button 
                                        id="buttonAddDiagnostic"
                                        class="d-inline-block" 
                                        type="button"
                                        nbButton 
                                        (click)="fnAddNewDiagnostic(selectPatientDiagnostics, selectPatientEtiology, patientInputDiagnosticDate)"
                                        size="large" 
                                        status="info">
                                        <i class="fas fa-plus-circle text-ligth"></i>
                                      </button>
                                    </span>
                                  </div>
                                </div>
                              </div>
                              <div class="row d-flex justify-content-center" *ngIf="true">
                                <span class="cursor-pointer" (click)="fnShowDiagnostics(flagShowDiagnostics)" [ngStyle]="{'margin-top': flagShowDiagnostics ? '0' : '-1.3rem'}" style="background: #4da6ff;color: #fff;padding: 10px 25px;border-radius: 0 0 10px 10px; z-index: 1;" tooltip="{{ (flagShowDiagnostics) ? 'Cerrar' : 'Agregar diagnóstico +'}}" placement="top" container="body">
                                  <i class="showDiagnostics fas fa-arrow-down" [ngClass]="{'rotate-arrow-open': flagShowDiagnostics, 'rotate-arrow-close': !flagShowDiagnostics}"></i>
                                </span>
                              </div>
                              <div class="row">
                                <!-- <div class="col-12">
                                  <hr>
                                </div> -->
                                <div class="col-12" *ngIf="listDiagnosticsPatient?.length > 0">
                                  <div class="">
                                    <div class="d-flex justify-content-between align-items-center">
                                      <div>
                                        <label for="input-patientSigns">
                                          <small class="m-0 cursor-pointer">
                                            <i class="fas fa-chevron-right"></i>&nbsp;Diagn&oacute;sticos agregados:&nbsp;
                                          </small>
                                          <small class="text-danger" *ngIf="validDiagnostic">
                                            <i class="fas fa-times-circle"></i>&nbsp;Diagn&oacute;stico ya se encuentra agregado.
                                          </small>
                                        </label>
                                      </div>
                                      <div>
                                        <!-- <button
                                          nbButton 
                                          status="basic" 
                                          fullWidth
                                          >
                                          <i class="fas fa-plus-square info"></i>
                                        </button> -->
                                      </div>
                                    </div>
                                    <div class="listPatientSigns" style="display: block;">
                                      <div class="d-flex justify-content-between diagnostic-{{i}} animated pulse mb-2" style="border: 1px solid #c8c8c8; border-radius: 5px; font-size: 1em; background-color: #ececec !important; color: #000; padding: 15px; font-weight: 400;" *ngFor="let item of listDiagnosticsPatient; let i=index">
                                        <span class="text-truncate d-inline-block" style="max-width: 95%;">
                                          <!-- <span class="badge bg-light" style="font-size: 90% !important;"> -->
                                          <span>
                                            {{ item.tCie10 }} - {{ item.tDescripcion }}
                                            <!-- <i class="fas fa-edit cursor-pointer" tooltip="Editar diagnóstico" placement="top" container="body"></i> -->
                                          </span>
                                          &nbsp;
                                          <!-- <span class="badge bg-light" style="font-size: 90% !important;"> -->
                                          <span>
                                            {{ item.nombreEtiologia }}
                                            <!-- <i class="fas fa-edit cursor-pointer" tooltip="Editar etiología" placement="top" container="body"></i> -->
                                          </span>
                                          &nbsp;
                                          <!-- <span class="badge bg-light" style="font-size: 90% !important;"> -->
                                          <span>
                                            {{ item.fechaIncapacidad | date: 'dd/MM/yyyy' }}
                                            <!-- <i class="fas fa-edit cursor-pointer" tooltip="Editar etiología" placement="top" container="body"></i> -->
                                          </span>
                                        </span>
                                        <i (click)="fnRemoveDiagnostic(item, i, listDiagnosticsPatient)" tooltip="Eliminar diagnóstico" placement="top" container="body" class="fas fa-times-circle" style="cursor: pointer; color: #f86161; display: inline-block; font-size: 15px;"></i>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <div class="col-12 d-flex justify-content-center mt-4" *ngIf="listDiagnosticsPatient.length < 1 || !listDiagnosticsPatient">
                                  <span class="text-center">
                                    <img src="../../../../assets/images/imgs/empty-inbox.png" width="20%" style="filter: grayscale(100%);opacity: 0.5;" alt="Imagen listado vacio">
                                    <h6 class="mt-2" style="color: #9f9f9f">Concepto sin diagnosticos</h6>
                                    <p class="mt-1" style="color: #9f9f9f">
                                      Se deben agregar diagnosticos para poder generar un concepto de rehabilitaci&oacute;n.
                                    </p>
                                  </span>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- *********** END - Diagnostico paciente *********** -->
                      <div class="row">
                        <div class="col">
                          <div class="mb-4 pb-4 animated fadeIn d-flex justify-content-center align-items-center">
                            <button 
                              nbButton 
                              class="cursor-pointer" 
                              shape="round" 
                              size="small" 
                              status="info" 
                              style="background-color: #0177b5;" 
                              (click)="fnShoewPreviewCRHB()" 
                              [disabled]="false">
                              <i class="fas fa-eye"></i>&nbsp;
                              Vista preliminar
                            </button>
                            &nbsp;
                            <button 
                              nbButton 
                              class="cursor-pointer" 
                              shape="round" 
                              size="small" 
                              status="info" 
                              style="background-color: #0177b5;" 
                              (click)="fnUpdateConcept()" 
                              [disabled]="false">
                              <i class="fas fa-save"></i>&nbsp;
                              Guardar
                            </button>
                            &nbsp;
                            <button 
                              nbButton 
                              class="cursor-pointer" 
                              nbStepperNext 
                              shape="round" 
                              size="small" 
                              status="info" 
                              (click)="fnClickStep(1)"
                              [disabled]="false">
                              <!-- Siguiente&nbsp; -->
                              <i class="fas fa-chevron-right"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                    </form>
                  </nb-step>

                  <nb-step label="Secuelas">
                    <form #secuelasForm="ngForm" class="step-container">
                      <!-- <div class="input-group">
                        <input type="text"
                               placeholder="Enter your favorite movie"
                               class="form-control"
                               name="movie"
                               required
                               nbInput
                               ngModel
                               #movie="ngModel"
                               [status]="movie.invalid ? 'danger' : 'basic'">
                      </div> -->
                      <!-- ********** START - Descripcion de secuelas ********** -->
                      <div class="row">
                        <div class="mt-2 mb-2 col-12">
                          <div class="card">
                            <div class="card-header">
                              Secuelas
                            </div>
                            <div class="card-body">
                              <div class="content-form-add-sequels" style="display: none;">
                                <div class="row pb-2" style="border-bottom: solid 1px #d8d8d8;border-radius: 15px;box-shadow: 3px 17px 27px -18px;">
                                  <!-- ********** START - Tipo de secuela ********** -->
                                  <div class="col-4">
                                    <div class="form-group">
                                      <label for="input-patientTypeSequel">
                                        <h5 class="m-0">
                                          <i class="fas fa-wheelchair"></i>&nbsp;Tipo de secuela:&nbsp;
                                          <span class="text-danger cursor-pointer" tooltip="Campo obligatorio" placement="top" container="body">*</span>
                                        </h5>
                                      </label>
                                      <ng-select 
                                        [items]="collectionTypeSequel" 
                                        [virtualScroll]="true" 
                                        [multiple]="false" 
                                        [closeOnSelect]="true"
                                        [searchable]="true" 
                                        [hideSelected]="true" 
                                        bindLabel="tDescripcion"
                                        id="input-patientTypeSequel" 
                                        name="patientTypeSequel" 
                                        #patientTypeSequel="ngModel"
                                        [(ngModel)]="selectPatientTypeSequel"
                                        [ngModelOptions]="{standalone: true}" 
                                        placeholder="Seleccione tipo de secuela" 
                                        required 
                                        [disabled]="false" 
                                        [clearable]="true">
                                        <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                                          <div class="ng-value" *ngFor="let item of items | slice:0:2" style="padding: 8px; border-radius: 10px;">
                                              <span class="ng-value-label">{{item.tDescripcion}}</span>
                                              <span class="ng-value-icon right" (click)="clear(item)" aria-hidden="true">×</span>
                                          </div>
                                          <div class="ng-value" *ngIf="items.length > 2">
                                              <span class="ng-value-label">{{items.length - 2}} m&aacute;s...</span>
                                          </div>
                                        </ng-template>
                                      </ng-select>
        
                                      <!-- <div class="mt-3" *ngIf="patientData?.diagnostic?.patientDiagnostics?.tCie10">
                                        <label for="input-patientDiagnostics">
                                          <small class="m-0 cursor-pointer">
                                            <i class="fas fa-chevron-right"></i>&nbsp;Diagn&oacute;stico seleccionado:&nbsp;
                                          </small>
                                        </label>
                                        <div class="listPatientDiagnostics m-2" style="display: none;">
                                          <div class="m-2 d-flex justify-content-between" style="border-radius: 5px; font-size: .9em; background-color: #ebf5ff !important; color: #000; padding: 5px; font-weight: 400;">
                                            <span class="text-truncate d-inline-block" style="max-width: 95%;">{{ patientData?.diagnostic?.patientDiagnostics?.tFullDescripcion }}</span>
                                            <i (click)="fnRemovePatientDiagnostic(patientData.diagnostic.patientDiagnostics)" tooltip="Eliminar síntoma" placement="top" container="body" class="fas fa-times-circle" style="cursor: pointer; color: #f86161; display: inline-block; font-size: 15px;"></i>
                                          </div>
                                        </div>
                                      </div> -->
        
                                    </div>
                                  </div>
                                  <!-- *********** END - Tipo de secuela *********** -->
                                  <!-- ********** START - Pronóstico ********** -->
                                  <div class="col-4">
                                    <div class="form-group">
                                      <label for="input-patientMedicalPrognosis">
                                        <h5 class="m-0">
                                          <i class="fas fa-blind"></i>&nbsp;Pron&oacute;stico:&nbsp;
                                          <span class="text-danger cursor-pointer" tooltip="Campo obligatorio" placement="top" container="body">*</span>
                                        </h5>
                                      </label>
                                      <ng-select 
                                        [items]="collectionMedicalPrognosis" 
                                        [multiple]="false" 
                                        [closeOnSelect]="true"
                                        [searchable]="true" 
                                        [hideSelected]="true" 
                                        bindLabel="tDescripcion"
                                        id="input-patientMedicalPrognosis" 
                                        name="patientMedicalPrognosis" 
                                        #patientMedicalPrognosis="ngModel"
                                        [(ngModel)]="selectPatientMedicalPrognosis"
                                        [ngModelOptions]="{standalone: true}" 
                                        placeholder="Seleccione pronóstico"
                                        required 
                                        [disabled]="false" 
                                        [clearable]="true">
                                        <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                                          <div class="ng-value" *ngFor="let item of items | slice:0:2" style="padding: 8px; border-radius: 10px;">
                                              <span class="ng-value-label">{{item.tDescripcion}}</span>
                                              <span class="ng-value-icon right" (click)="clear(item)" aria-hidden="true">×</span>
                                          </div>
                                          <div class="ng-value" *ngIf="items.length > 2">
                                              <span class="ng-value-label">{{items.length - 2}} m&aacute;s...</span>
                                          </div>
                                        </ng-template>
                                      </ng-select>
                                    </div>
                                  </div>
                                  <!-- *********** END - Pronóstico *********** -->
                                  <!-- ********** START - Descripcion secuela ********** -->
                                  <div class="col-3">
                                    <div class="form-group">
                                      <label for="input-patientSequelDescription">
                                        <h5 class="m-0">
                                          <i class="fas fa-file-medical"></i>&nbsp;Descripci&oacute;n secuela:&nbsp;
                                          <span class="text-danger cursor-pointer" tooltip="Campo obligatorio" placement="top" container="body">*</span>
                                        </h5>
                                      </label>
                                      <textarea 
                                        nbInput 
                                        fullWidth 
                                        id="input-patientSequelDescription"  
                                        name="patientSequelDescription" 
                                        [disabled]="false" 
                                        [readonly]="false" 
                                        [(ngModel)]="patientInputSequelDescription" 
                                        [ngModelOptions]="{standalone: true}"
                                        [status]="patientSequelDescription.dirty ? (patientSequelDescription.invalid  ? 'danger' : 'info') : 'info'" 
                                        #patientSequelDescription="ngModel"
                                        placeholder="Escribe una descripción de la secuela">
                                      </textarea>
                                      <input 
                                        *ngIf="false"
                                        class="cursor-pointer"
                                        nbInput
                                        fullWidth 
                                        fieldSize="large"  
                                        type="text" 
                                        [readonly]="true" 
                                        [disabled]="false" 
                                        placeholder="Escribe una descripción de la secuela"
                                        id="input-patientSequelDescription"  
                                        name="patientSequelDescription" 
                                        [(ngModel)]="patientInputSequelDescription" 
                                        [ngModelOptions]="{standalone: true}"
                                        [status]="patientSequelDescription.dirty ? (patientSequelDescription.invalid  ? 'danger' : 'basic') : 'basic'" 
                                        #patientSequelDescription="ngModel"
                                        bsDatepicker 
                                        [maxDate]="maxDate"
                                        [bsConfig]="{ dateInputFormat: 'DD-MM-YYYY', containerClass: 'theme-blue' }">
                                        <!-- <i class="far fa-calendar-alt cursor-pointer" style="position: absolute; right: 25px; font-size: 2rem; color: #007bff;"></i> -->
                                    </div>
                                  </div>
                                  <!-- *********** END - Descripcion secuela *********** -->
                                  <div class="col-1 d-flex align-items-center">
                                    <span tooltip="Agregar nueva secuela" placement="top" container="body">
                                      <button 
                                        id="buttonAddDiagnostic"
                                        class="d-inline-block" 
                                        type="button"
                                        nbButton 
                                        (click)="fnAddNewSequel(selectPatientTypeSequel, selectPatientMedicalPrognosis, patientInputSequelDescription)"
                                        size="large" 
                                        status="info">
                                        <i class="fas fa-plus-circle text-ligth"></i>
                                      </button>
                                    </span>
                                  </div>
                                </div>
                              </div>
                              <div class="row d-flex justify-content-center">
                                <span class="cursor-pointer" (click)="fnShowSequels(flagShowSequels)" [ngStyle]="{'margin-top': flagShowSequels ? '0' : '-1.3rem'}" style="background: #4da6ff;color: #fff;padding: 10px 25px;border-radius: 0 0 10px 10px; z-index: 1;" tooltip="{{ (flagShowSequels) ? 'Cerrar' : 'Agregar secuela +'}}" placement="top" container="body">
                                  <i class="showSequels fas fa-arrow-down" [ngClass]="{'rotate-arrow-open': flagShowSequels, 'rotate-arrow-close': !flagShowSequels}"></i>
                                </span>
                              </div>
                              <div class="row">
                                <div class="col-12">
                                  <div class="" *ngIf="listSequelsPatient?.length > 0">
                                    <label for="input-patientSigns">
                                      <small class="m-0 cursor-pointer">
                                        <i class="fas fa-chevron-right"></i>&nbsp;Secuelas agregadas:&nbsp;
                                      </small>
                                    </label>
                                    <div class="listPatientSigns m-2" style="display: block;">
                                      <div class="m-2 d-flex justify-content-between animated pulse" style="border-radius: 5px; font-size: 1em; background-color: #ececec !important; color: #000; padding: 15px; font-weight: 400;" *ngFor="let item of listSequelsPatient; let i=index">
                                        <span class="text-truncate d-inline-block" style="max-width: 95%;">
                                          {{ item.nameTypeSequel }} - {{ item.nameMedicalPrognosis }} - {{ item.sequelDescription }}
                                        </span>
                                        <i (click)="fnRemoveSequel(item, i, listSequelsPatient)" tooltip="Eliminar secuela" placement="top" container="body" class="fas fa-times-circle" style="cursor: pointer; color: #f86161; display: inline-block; font-size: 15px;"></i>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <div class="col-12 d-flex justify-content-center mt-4" *ngIf="listSequelsPatient.length < 1 || !listSequelsPatient">
                                  <span class="text-center">
                                    <img src="../../../../assets/images/imgs/empty-inbox.png" width="20%" style="filter: grayscale(100%);opacity: 0.5;" alt="Imagen listado vacio">
                                    <h6 class="mt-2" style="color: #9f9f9f">Concepto sin secuelas</h6>
                                    <p class="mt-1" style="color: #9f9f9f">
                                      Se deben agregar secuelas para poder generar un concepto de rehabilitaci&oacute;n.
                                    </p>
                                  </span>
                                </div>
                                <div class="col-12">
                                  <hr>
                                  <div class="form-group" *ngIf="true">
                                    <label for="input-patientClinicHistorySummary">
                                      <h5 class="m-0">
                                        <i class="fas fa-file-prescription"></i>&nbsp;Resum&eacute;n historia cl&iacute;nica y estado actual del paciente:&nbsp;
                                        <span class="text-danger cursor-pointer" tooltip="Campo obligatorio" placement="top" container="body">*</span>
                                      </h5>
                                    </label>
                                    <textarea 
                                      nbInput 
                                      fullWidth 
                                      [readonly]="false" 
                                      [disabled]="false" 
                                      placeholder="Escribe aquí un resumén de la historia clínica del paciente y su estado actual ..." 
                                      id="input-patientClinicHistorySummary"  
                                      name="patientClinicHistorySummary" 
                                      (blur)="fnGetPercentaje();"
                                      (input)="fnGetPercentaje(); fnClickStep(2)"
                                      [(ngModel)]="dataConceptForm.ResumenHistoriaClinica" 
                                      [ngModelOptions]="{standalone: true}"
                                      [status]="dataConceptForm.ResumenHistoriaClinica == '' || dataConceptForm.ResumenHistoriaClinica == null ? 'danger' : 'basic'" 
                                      #patientClinicHistorySummary="ngModel" 
                                      rows="6">
                                    </textarea>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- *********** END - Descripcion de secuelas *********** -->
                      <div class="row">
                        <div class="col">
                          <div class="mb-4 pb-4 animated fadeIn d-flex justify-content-center align-items-center">
                            <button 
                              nbButton 
                              class="cursor-pointer" 
                              nbStepperPrevious 
                              shape="round" 
                              size="small" 
                              status="info"
                              [disabled]="false">
                              <i class="fas fa-chevron-left"></i>
                              <!-- &nbsp;Anterior -->
                            </button>
                            &nbsp;
                            <button 
                              nbButton 
                              class="cursor-pointer" 
                              shape="round" 
                              size="small" 
                              status="info" 
                              style="background-color: #0177b5;" 
                              (click)="fnShoewPreviewCRHB()" 
                              [disabled]="false">
                              <i class="fas fa-eye"></i>&nbsp;
                              Vista preliminar
                            </button>
                            &nbsp;
                            <button 
                              nbButton 
                              class="cursor-pointer" 
                              shape="round" 
                              size="small" 
                              status="info" 
                              style="background-color: #0177b5;" 
                              (click)="fnUpdateConcept()" 
                              [disabled]="false">
                              <i class="fas fa-save"></i>&nbsp;
                              Guardar
                            </button>
                            &nbsp;
                            <button 
                              nbButton 
                              class="cursor-pointer" 
                              nbStepperNext 
                              shape="round" 
                              size="small" 
                              status="info" 
                              (click)="fnClickStep(2)"
                              [disabled]="false">
                              <!-- Siguiente&nbsp; -->
                              <i class="fas fa-chevron-right"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                    </form>
                  </nb-step>

                  <nb-step label="Terapeutica posible">
                    <form #terapeuticaPosibleForm="ngForm" class="step-container">
                      <!-- <div class="input-group">
                        <input type="text"
                               placeholder="Enter something"
                               class="form-control"
                               name="something"
                               required
                               nbInput
                               ngModel
                               #somethingInput="ngModel"
                               [status]="movie.invalid ? 'danger' : 'basic'">
                      </div> -->
                      <!-- ********** START - Terapeutica posible ********** -->
                      <div class="row">
                        <div class="mt-2 mb-2 col-12">
                          <div class="card">
                            <div class="card-header">
                              Terapeutica posible
                            </div>
                            <div class="card-body" style="padding-bottom: 3rem;">
                              <div class="row">
                                <!-- ********** START - Finalidad del tratamiento ********** -->
                                <div class="col-4">
                                  <div class="form-group">
                                    <label for="input-patientTypeSequel">
                                      <h5 class="m-0">
                                        <i class="fas fa-wheelchair"></i>&nbsp;
                                        Finalidad del tratamiento 
                                        <small>(posibilidad de recuperaci&oacute;n)</small>:&nbsp;
                                        <span class="text-danger cursor-pointer" tooltip="Campo obligatorio" placement="top" container="body">*</span>
                                      </h5>
                                    </label>
                                    <ng-select 
                                      [items]="collectionTreatmentPurpose" 
                                      [virtualScroll]="true" 
                                      [multiple]="false" 
                                      [closeOnSelect]="true"
                                      [searchable]="true" 
                                      [hideSelected]="true" 
                                      bindLabel="tDescripcion" 
                                      bindValue="iIDMultivalor" 
                                      iIDMultivalor="value"
                                      id="input-patientTypeSequel" 
                                      name="patientTypeSequel" 
                                      (change)="fnValidInput(3);"
                                      #patientTypeSequel="ngModel"
                                      [(ngModel)]="dataConceptForm.FinalidadTratamientos"
                                      [ngModelOptions]="{standalone: true}" 
                                      placeholder="Seleccione tipo de secuela" 
                                      required 
                                      [disabled]="false" 
                                      [clearable]="true">
                                      <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                                        <div class="ng-value" *ngFor="let item of items | slice:0:2" style="padding: 8px; border-radius: 10px;">
                                            <span class="ng-value-label">{{item.tDescripcion}}</span>
                                            <span class="ng-value-icon right" (click)="clear(item)" aria-hidden="true">×</span>
                                        </div>
                                        <div class="ng-value" *ngIf="items.length > 2">
                                            <span class="ng-value-label">{{items.length - 2}} m&aacute;s...</span>
                                        </div>
                                      </ng-template>
                                    </ng-select>
      
                                    <!-- <div class="mt-3" *ngIf="patientData?.diagnostic?.patientDiagnostics?.tCie10">
                                      <label for="input-patientDiagnostics">
                                        <small class="m-0 cursor-pointer">
                                          <i class="fas fa-chevron-right"></i>&nbsp;Diagn&oacute;stico seleccionado:&nbsp;
                                        </small>
                                      </label>
                                      <div class="listPatientDiagnostics m-2" style="display: none;">
                                        <div class="m-2 d-flex justify-content-between" style="border-radius: 5px; font-size: .9em; background-color: #ebf5ff !important; color: #000; padding: 5px; font-weight: 400;">
                                          <span class="text-truncate d-inline-block" style="max-width: 95%;">{{ patientData?.diagnostic?.patientDiagnostics?.tFullDescripcion }}</span>
                                          <i (click)="fnRemovePatientDiagnostic(patientData.diagnostic.patientDiagnostics)" tooltip="Eliminar síntoma" placement="top" container="body" class="fas fa-times-circle" style="cursor: pointer; color: #f86161; display: inline-block; font-size: 15px;"></i>
                                        </div>
                                      </div>
                                    </div> -->
      
                                  </div>
                                </div>
                                <!-- *********** END - Finalidad del tratamiento *********** -->
                                <!-- ********** START - Tipo de tratamiento ********** -->
                                <div class="col-8">
                                  <div class="row m-0 p-0">
                                    <div class="col-4 mt-2 mb-2">
  
                                      <h5 class="text-center">
                                        Farmacol&oacute;gico
                                      </h5>
                                      <span class="cursor-pointer m-1 d-flex align-items-center justify-content-center">
                                        <!-- Rounded switch -->
                                        <h6>No</h6>&nbsp;
                                        <label class="switch" style="margin-top: 0.2rem;" tooltip="Tratamiento Farmacol&oacute;gico" placement="top" container="body">
                                          <input 
                                            [ngModelOptions]="{standalone: true}" 
                                            [(ngModel)]="dataConceptForm.EsFarmacologico"
                                            type="checkbox" 
                                            (change)="fnValidInput(3);"
                                            [checked]="(dataConceptForm.EsFarmacologico)?'checked':false">
                                          <span class="slider round"></span>
                                        </label>
                                        &nbsp;
                                        <h6>Si</h6>
                                      </span>
                                    </div>
                                    <div class="col-4 mt-2 mb-2">
  
                                      <h5 class="text-center">
                                        Terapia ocupacional
                                      </h5>
                                      <span class="cursor-pointer m-1 d-flex align-items-center justify-content-center">
                                        <!-- Rounded switch -->
                                        <h6>No</h6>&nbsp;
                                        <label class="switch" style="margin-top: 0.2rem;" tooltip="Terapia ocupacional" placement="top" container="body">
                                          <input 
                                            [ngModelOptions]="{standalone: true}" 
                                            [(ngModel)]="dataConceptForm.EsTerapiaOcupacional"
                                            type="checkbox" 
                                            (change)="fnValidInput(3);"
                                            [checked]="(dataConceptForm.EsTerapiaOcupacional)?'checked':false">
                                          <span class="slider round"></span>
                                        </label>
                                        &nbsp;
                                        <h6>Si</h6>
                                      </span>
                                    </div>
                                    <div class="col-4 mt-2 mb-2">
  
                                      <h5 class="text-center">
                                        Fonoaudiologia
                                      </h5>
                                      <span class="cursor-pointer m-1 d-flex align-items-center justify-content-center">
                                        <!-- Rounded switch -->
                                        <h6>No</h6>&nbsp;
                                        <label class="switch" style="margin-top: 0.2rem;" tooltip="Fonoaudiologia" placement="top" container="body">
                                          <input 
                                            [ngModelOptions]="{standalone: true}" 
                                            [(ngModel)]="dataConceptForm.EsFonoaudiologia"
                                            type="checkbox" 
                                            (change)="fnValidInput(3);"
                                            [checked]="(dataConceptForm.EsFonoaudiologia)?'checked':false">
                                          <span class="slider round"></span>
                                        </label>
                                        &nbsp;
                                        <h6>Si</h6>
                                      </span>
  
                                      <!-- <div class="col-4 mt-2 mb-2">
                                      <div class="form-check form-check-inline">
                                        <input 
                                          [ngModelOptions]="{standalone: true}"
                                          [(ngModel)]="checkSpeechTherapy" 
                                          class="form-check-input" 
                                          type="checkbox"  
                                          id="checkSpeechTherapy">
                                        <label class="form-check-label" for="checkSpeechTherapy">Fonoaudiologia</label>
                                      </div>
                                    </div> -->
                                      
                                    </div>
                                    <div class="col-4 mt-2 mb-2">
  
                                      <h5 class="text-center">
                                        Quir&uacute;rgico
                                      </h5>
                                      <span class="cursor-pointer m-1 d-flex align-items-center justify-content-center">
                                        <!-- Rounded switch -->
                                        <h6>No</h6>&nbsp;
                                        <label class="switch" style="margin-top: 0.2rem;" tooltip="Quirúrgico" placement="top" container="body">
                                          <input 
                                            [ngModelOptions]="{standalone: true}" 
                                            [(ngModel)]="dataConceptForm.EsQuirurgico"
                                            type="checkbox" 
                                            (change)="fnValidInput(3);"
                                            [checked]="(dataConceptForm.EsQuirurgico)?'checked':false">
                                          <span class="slider round"></span>
                                        </label>
                                        &nbsp;
                                        <h6>Si</h6>
                                      </span>
                                      
                                    </div>
                                    <div class="col-4 mt-2 mb-2">
  
                                      <h5 class="text-center">
                                        Terapia f&iacute;sica
                                      </h5>
                                      <span class="cursor-pointer m-1 d-flex align-items-center justify-content-center">
                                        <!-- Rounded switch -->
                                        <h6>No</h6>&nbsp;
                                        <label class="switch" style="margin-top: 0.2rem;" tooltip="Terapia física" placement="top" container="body">
                                          <input 
                                            [ngModelOptions]="{standalone: true}" 
                                            [(ngModel)]="dataConceptForm.EsTerapiaFisica"
                                            type="checkbox" 
                                            (change)="fnValidInput(3);"
                                            [checked]="(dataConceptForm.EsTerapiaFisica)?'checked':false">
                                          <span class="slider round"></span>
                                        </label>
                                        &nbsp;
                                        <h6>Si</h6>
                                      </span>
                                      
                                    </div>
                                    <div class="col-4 mt-2 mb-2">
  
                                      <h5 class="text-center">
                                        Otros tratamientos
                                      </h5>
                                      <span class="cursor-pointer m-1 d-flex align-items-center justify-content-center">
                                        <!-- Rounded switch -->
                                        <h6>No</h6>&nbsp;
                                        <label class="switch" style="margin-top: 0.2rem;" tooltip="Otros tramites" placement="top" container="body">
                                          <input 
                                            [ngModelOptions]="{standalone: true}" 
                                            [(ngModel)]="dataConceptForm.EsOtrosTratamientos"
                                            type="checkbox" 
                                            (change)="fnValidInput(3);"
                                            [checked]="(dataConceptForm.EsOtrosTratamientos)?'checked':false">
                                          <span class="slider round"></span>
                                        </label>
                                        &nbsp;
                                        <h6>Si</h6>
                                      </span>
                                      
                                    </div>
                                  </div>
                                </div>
                                <!-- *********** END - Tipo de tratamiento *********** -->
                                <!-- ********** START - Descripcion de otro tratamiento ********** -->
                                <div class="col-12" *ngIf="dataConceptForm.EsOtrosTratamientos">
                                  <div class="form-group" *ngIf="true">
                                    <label for="input-patientOtherTreatments">
                                      <h5 class="m-0">
                                        <i class="fas fa-file-prescription"></i>&nbsp;Especifique otros tratamientos:&nbsp;
                                        <small>(Debe agregar una descripci&oacute;n para especificar otros tratamientos si marco la opci&oacute;n superior de 'Otros tratamientos')</small> &nbsp;
                                        <span class="text-danger cursor-pointer" tooltip="Campo obligatorio" placement="top" container="body">*</span>
                                      </h5>
                                    </label>
                                    <textarea 
                                      nbInput 
                                      fullWidth 
                                      [readonly]="false" 
                                      [disabled]="false" 
                                      placeholder="Escribe aquí descriptivamente que otros tratamientos podria necesitar el paciente ..." 
                                      id="input-patientOtherTreatments"  
                                      name="patientOtherTreatments" 
                                      (blur)="fnValidInput(3);"
                                      (input)="fnValidInput(3);"
                                      [(ngModel)]="dataConceptForm.DescripcionOtrosTratamientos" 
                                      [ngModelOptions]="{standalone: true}"
                                      [status]="patientOtherTreatments.dirty ? (patientOtherTreatments.invalid  ? 'danger' : 'basic') : 'basic'" 
                                      #patientOtherTreatments="ngModel" 
                                      rows="6">
                                    </textarea>
                                  </div>
                                </div>
                                <!-- *********** END - Descripcion de otro tratamiento *********** -->
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- *********** END - Terapeutica posible *********** -->
                      <div class="row">
                        <div class="col">
                          <div class="mb-4 pb-4 animated fadeIn d-flex justify-content-center align-items-center">
                            <button 
                              nbButton 
                              class="cursor-pointer" 
                              nbStepperPrevious 
                              shape="round" 
                              size="small" 
                              status="info"
                              [disabled]="false">
                              <i class="fas fa-chevron-left"></i>
                              <!-- &nbsp;Anterior -->
                            </button>
                            &nbsp;
                            <button 
                              nbButton 
                              class="cursor-pointer" 
                              shape="round" 
                              size="small" 
                              status="info" 
                              style="background-color: #0177b5;" 
                              (click)="fnShoewPreviewCRHB()" 
                              [disabled]="false">
                              <i class="fas fa-eye"></i>&nbsp;
                              Vista preliminar
                            </button>
                            &nbsp;
                            <button 
                              nbButton 
                              class="cursor-pointer" 
                              shape="round" 
                              size="small" 
                              status="info" 
                              style="background-color: #0177b5;" 
                              (click)="fnUpdateConcept()" 
                              [disabled]="false">
                              <i class="fas fa-save"></i>&nbsp;
                              Guardar
                            </button>
                            &nbsp;
                            <button 
                              nbButton 
                              class="cursor-pointer" 
                              nbStepperNext 
                              shape="round" 
                              size="small" 
                              status="info" 
                              (click)="fnClickStep(3); fnClickStep(4);"
                              [disabled]="false">
                              <!-- Siguiente&nbsp; -->
                              <i class="fas fa-chevron-right"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                    </form>
                  </nb-step>

                  <nb-step label="Pronóstico">
                    <form #pronosticoForm="ngForm" class="step-container">
                      <!-- <div class="input-group">
                        <input type="text"
                               placeholder="Enter other"
                               class="form-control"
                               name="other"
                               required
                               nbInput
                               ngModel
                               #otherInput="ngModel"
                               [status]="movie.invalid ? 'danger' : 'basic'">
                      </div> -->
                      <!-- ********** START - Pronotico paciente ********** -->
                      <div class="row">
                        <div class="mt-2 mb-2 col-12">
                          <div class="card">
                            <div class="card-header">
                              Pron&oacute;stico paciente
                            </div>
                            <div class="card-body" style="padding-bottom: 3rem;">
                              <div class="row">
                                <!-- ********** START - Finalidad del tratamiento ********** -->
                                <div class="col-4">
                                  
                                  <label for="input-patientTypeSequel">
                                    <h5 class="m-0">
                                      <i class="fas fa-wheelchair"></i>&nbsp;
                                      Corto plazo 
                                      <small>(menor a 1 a&ntilde;o)</small>:&nbsp;
                                      <span class="text-danger cursor-pointer" tooltip="Campo obligatorio" placement="top" container="body">*</span>
                                    </h5>
                                  </label>
  
                                  <div class="row m-0 p-0">
                                    <div class="col-4 mt-2 mb-2">
                                      
                                      <h5 class="text-center">
                                        Bueno
                                      </h5>
                                      <span class="cursor-pointer m-1 d-flex align-items-center justify-content-center">
                                        <!-- Rounded switch -->
                                        <h6>No</h6>&nbsp;
                                        <label class="switch" style="margin-top: 0.2rem;">
                                          <input 
                                            [ngModelOptions]="{standalone: true}" 
                                            [(ngModel)]="patientGoodShortTerm"
                                            type="checkbox" 
                                            (change)="fnChangeShortTermsValid(1); fnValidInput(4);"
                                            [checked]="(patientGoodShortTerm)?'checked':false">
                                          <span class="slider round"></span>
                                        </label>
                                        &nbsp;
                                        <h6>Si</h6>
                                      </span>
  
                                    </div>
                                    <div class="col-4 mt-2 mb-2">
  
                                      <h5 class="text-center">
                                        Regular
                                      </h5>
                                      <span class="cursor-pointer m-1 d-flex align-items-center justify-content-center">
                                        <!-- Rounded switch -->
                                        <h6>No</h6>&nbsp;
                                        <label class="switch" style="margin-top: 0.2rem;">
                                          <input 
                                            [ngModelOptions]="{standalone: true}" 
                                            [(ngModel)]="patientRegularShortTerm"
                                            type="checkbox" 
                                            (change)="fnChangeShortTermsValid(2); fnValidInput(4);"
                                            [checked]="(patientRegularShortTerm)?'checked':false">
                                          <span class="slider round"></span>
                                        </label>
                                        &nbsp;
                                        <h6>Si</h6>
                                      </span>
                                      
                                    </div>
                                    <div class="col-4 mt-2 mb-2">
  
                                      <h5 class="text-center">
                                        Malo
                                      </h5>
                                      <span class="cursor-pointer m-1 d-flex align-items-center justify-content-center">
                                        <!-- Rounded switch -->
                                        <h6>No</h6>&nbsp;
                                        <label class="switch" style="margin-top: 0.2rem;">
                                          <input 
                                            [ngModelOptions]="{standalone: true}" 
                                            [(ngModel)]="patientBadShortTerm"
                                            type="checkbox" 
                                            (change)="fnChangeShortTermsValid(3); fnValidInput(4);"
                                            [checked]="(patientBadShortTerm)?'checked':false">
                                          <span class="slider round"></span>
                                        </label>
                                        &nbsp;
                                        <h6>Si</h6>
                                      </span>
                                      
                                    </div>
                                  </div>
                                </div>
                                <!-- *********** END - Finalidad del tratamiento *********** -->
                                <!-- ********** START - Tipo de tratamiento ********** -->
                                <div class="col-4">
                                  <label for="input-patientTypeSequel">
                                    <h5 class="m-0">
                                      <i class="fas fa-wheelchair"></i>&nbsp;
                                      Mediano plazo  
                                      <small>(mayor a 1 a&ntilde;o)</small>:&nbsp;
                                      <span class="text-danger cursor-pointer" tooltip="Campo obligatorio" placement="top" container="body">*</span>
                                    </h5>
                                  </label>
                                  <div class="row m-0 p-0">
                                    <div class="col-4 mt-2 mb-2">
  
                                      <h5 class="text-center">
                                        Bueno
                                      </h5>
                                      <span class="cursor-pointer m-1 d-flex align-items-center justify-content-center">
                                        <!-- Rounded switch -->
                                        <h6>No</h6>&nbsp;
                                        <label class="switch" style="margin-top: 0.2rem;">
                                          <input 
                                            [ngModelOptions]="{standalone: true}" 
                                            [(ngModel)]="patientGoodMediumTerm"
                                            type="checkbox" 
                                            (change)="fnChangeMediumTermsValid(1); fnValidInput(4);"
                                            [checked]="(patientGoodMediumTerm)?'checked':false">
                                          <span class="slider round"></span>
                                        </label>
                                        &nbsp;
                                        <h6>Si</h6>
                                      </span>
                                      
                                    </div>
                                    <div class="col-4 mt-2 mb-2">
  
                                      <h5 class="text-center">
                                        Regular
                                      </h5>
                                      <span class="cursor-pointer m-1 d-flex align-items-center justify-content-center">
                                        <!-- Rounded switch -->
                                        <h6>No</h6>&nbsp;
                                        <label class="switch" style="margin-top: 0.2rem;">
                                          <input 
                                            [ngModelOptions]="{standalone: true}" 
                                            [(ngModel)]="patientRegularMediumTerm"
                                            type="checkbox" 
                                            (change)="fnChangeMediumTermsValid(2); fnValidInput(4);"
                                            [checked]="(patientRegularMediumTerm)?'checked':false">
                                          <span class="slider round"></span>
                                        </label>
                                        &nbsp;
                                        <h6>Si</h6>
                                      </span>
                                      
                                    </div>
                                    <div class="col-4 mt-2 mb-2">
  
                                      <h5 class="text-center">
                                        Malo
                                      </h5>
                                      <span class="cursor-pointer m-1 d-flex align-items-center justify-content-center">
                                        <!-- Rounded switch -->
                                        <h6>No</h6>&nbsp;
                                        <label class="switch" style="margin-top: 0.2rem;">
                                          <input 
                                            [ngModelOptions]="{standalone: true}" 
                                            [(ngModel)]="patientBadMediumTerm"
                                            type="checkbox" 
                                            (change)="fnChangeMediumTermsValid(3); fnValidInput(4);"
                                            [checked]="(patientBadMediumTerm)?'checked':false">
                                          <span class="slider round"></span>
                                        </label>
                                        &nbsp;
                                        <h6>Si</h6>
                                      </span>
                                      
                                    </div>
                                  </div>
                                </div>
                                <!-- *********** END - Tipo de tratamiento *********** -->
                                <!-- ********** START - Descripcion de otro tratamiento ********** -->
                                <div class="col-4">
                                  <div class="form-group">
                                    <label for="input-medicalConcept">
                                      <h5 class="m-0">
                                        <i class="fas fa-hand-holding-medical"></i>&nbsp;
                                        Concepto
                                        <span class="text-danger cursor-pointer" tooltip="Campo obligatorio" placement="top" container="body">*</span>
                                      </h5>
                                    </label>
                                    <ng-select 
                                      [items]="dataCollectionConcepts" 
                                      [virtualScroll]="true" 
                                      [multiple]="false" 
                                      [closeOnSelect]="true"
                                      [searchable]="true" 
                                      [hideSelected]="true" 
                                      bindLabel="name" 
                                      bindValue="value"
                                      id="input-medicalConcept" 
                                      name="medicalConcept" 
                                      #medicalConcept="ngModel"
                                      [(ngModel)]="selectMedicalConcept"
                                      [ngModelOptions]="{standalone: true}" 
                                      placeholder="Seleccione concepto" 
                                      (change)="fnSetMedicalConcept($event); fnValidInput(4);"  
                                      required 
                                      [disabled]="false" 
                                      [clearable]="true">
                                      <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                                        <div class="ng-value" *ngFor="let item of items | slice:0:2" style="padding: 8px; border-radius: 10px;">
                                            <span class="ng-value-label">{{item.name}}</span>
                                            <span class="ng-value-icon right" (click)="clear(item)" aria-hidden="true">×</span>
                                        </div>
                                        <div class="ng-value" *ngIf="items.length > 2">
                                            <span class="ng-value-label">{{items.length - 2}} m&aacute;s...</span>
                                        </div>
                                      </ng-template>
                                    </ng-select>
      
                                    <!-- <div class="mt-3" *ngIf="patientData?.diagnostic?.patientDiagnostics?.tCie10">
                                      <label for="input-patientDiagnostics">
                                        <small class="m-0 cursor-pointer">
                                          <i class="fas fa-chevron-right"></i>&nbsp;Diagn&oacute;stico seleccionado:&nbsp;
                                        </small>
                                      </label>
                                      <div class="listPatientDiagnostics m-2" style="display: none;">
                                        <div class="m-2 d-flex justify-content-between" style="border-radius: 5px; font-size: .9em; background-color: #ebf5ff !important; color: #000; padding: 5px; font-weight: 400;">
                                          <span class="text-truncate d-inline-block" style="max-width: 95%;">{{ patientData?.diagnostic?.patientDiagnostics?.tFullDescripcion }}</span>
                                          <i (click)="fnRemovePatientDiagnostic(patientData.diagnostic.patientDiagnostics)" tooltip="Eliminar síntoma" placement="top" container="body" class="fas fa-times-circle" style="cursor: pointer; color: #f86161; display: inline-block; font-size: 15px;"></i>
                                        </div>
                                      </div>
                                    </div> -->
      
                                  </div>
                                </div>
                                <!-- *********** END - Descripcion de otro tratamiento *********** -->
                              </div>
                              <div class="row" *ngIf="selectMedicalConcept == 1 || selectMedicalConcept == 2">
                                <div class="col-12 mt-3">
                                  <label for="input-medicalConcept">
                                    <h5 class="m-0">
                                      <i class="fas fa-hand-holding-medical"></i>&nbsp;
                                      Remisi&oacute;n administradora de fondo de pensiones 
                                      <span class="text-danger cursor-pointer" tooltip="Campo obligatorio" placement="top" container="body">*</span>
                                    </h5>
                                  </label>
                                  <div *ngIf="selectMedicalConcept == 1">
                                    <p>
                                      <!-- {{ descriptionMedicalConcept }} -->
                                      {{ collectionMedicalConcept[0]?.texto }}
                                      <!-- {{ collectionMedicalConcept[0]?.texto }} -->
                                    </p>
                                  </div>
                                  <div class="row" *ngIf="selectMedicalConcept == 2 && collectionMedicalConcept?.length > 0">
                  
                                    <div class="col-11 d-flex align-items-center">
                                      <p style="margin-right: 2rem;margin-bottom: 0;">
                                        {{ collectionMedicalConcept[1]?.texto }}
                                      </p>
                                    </div>
                                    <div class="col-1 d-flex align-items-center">
                                      <!-- <h5 class="text-center">
                                        Bueno
                                      </h5> -->
                                      <span class="cursor-pointer m-1 d-flex align-items-center justify-content-center">
                                        <!-- Rounded switch -->
                                        <h6>No</h6>&nbsp;
                                        <label class="switch" style="margin-top: 0.2rem;" tooltip="Con incapacidad" placement="top" container="body">
                                          <input 
                                            [ngModelOptions]="{standalone: true}" 
                                            [(ngModel)]="unfavTypeWithIncapacity" 
                                            (change)="fnCheckUnFavType(1); fnValidInput(4);"
                                            type="checkbox" 
                                            [checked]="(unfavTypeWithIncapacity)?'checked':false">
                                          <span class="slider round"></span>
                                        </label>
                                        &nbsp;
                                        <h6>Si</h6>
                                      </span>
                                    </div>
  
                                    <div class="col-12">
                                      <hr>
                                    </div>
  
                                    <div class="col-11 d-flex align-items-center">
                                      <p style="margin-right: 2rem;margin-bottom: 0;">
                                        {{ collectionMedicalConcept[2]?.texto }}
                                      </p>
                                    </div>
                                    <div class="col-1 d-flex align-items-center">
                                      <!-- <h5 class="text-center">
                                        Bueno
                                      </h5> -->
                                      <span class="cursor-pointer m-1 d-flex align-items-center justify-content-center">
                                        <!-- Rounded switch -->
                                        <h6>No</h6>&nbsp;
                                        <label class="switch" style="margin-top: 0.2rem;" tooltip="Sin incapacidad" placement="top" container="body">
                                          <input 
                                            [ngModelOptions]="{standalone: true}" 
                                            [(ngModel)]="unfavTypeNoIncapacity" 
                                            (change)="fnCheckUnFavType(2); fnValidInput(4);"
                                            type="checkbox" 
                                            [checked]="(unfavTypeNoIncapacity)?'checked':false">
                                          <span class="slider round"></span>
                                        </label>
                                        &nbsp;
                                        <h6>Si</h6>
                                      </span>
                                    </div>
                
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- *********** END - Pronotico paciente *********** -->
                      <div class="row">
                        <div class="col">
                          <div class="mb-4 pb-4 animated fadeIn d-flex justify-content-center align-items-center">
                            <button 
                              nbButton 
                              class="cursor-pointer" 
                              nbStepperPrevious 
                              shape="round" 
                              size="small" 
                              status="info"
                              [disabled]="false">
                              <i class="fas fa-chevron-left"></i>
                              <!-- &nbsp;Anterior -->
                            </button>
                            &nbsp;
                            <button 
                              nbButton 
                              class="cursor-pointer" 
                              shape="round" 
                              size="small" 
                              status="info" 
                              style="background-color: #0177b5;" 
                              (click)="fnShoewPreviewCRHB()" 
                              [disabled]="false">
                              <i class="fas fa-eye"></i>&nbsp;
                              Vista preliminar
                            </button>
                            &nbsp;
                            <button 
                              nbButton 
                              class="cursor-pointer" 
                              shape="round" 
                              size="small" 
                              status="info" 
                              style="background-color: #0177b5;" 
                              (click)="fnUpdateConcept()" 
                              [disabled]="false">
                              <i class="fas fa-save"></i>&nbsp;
                              Guardar
                            </button>
                            &nbsp;
                            <!-- <button 
                              nbButton 
                              class="cursor-pointer" 
                              nbStepperNext 
                              shape="round" 
                              size="small" 
                              status="info"
                              [disabled]="false">
                              Siguiente&nbsp;
                              <i class="fas fa-chevron-right"></i>
                            </button> -->
                            <button 
                              nbButton 
                              class="cursor-pointer" 
                              nbStepperNext 
                              shape="round" 
                              size="small" 
                              status="info" 
                              style="background-color: #0177b5;" 
                              (click)="fnEmmitConcept()"
                              [disabled]="percentajeConcept < 100">
                              Emitir&nbsp;
                              <i class="fas fa-share"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                    </form>
                  </nb-step>

                  <nb-step label="Carta" *ngIf="false">
                    <form #cartaForm="ngForm" class="step-container">
                      <!-- <div class="input-group">
                        <input type="text"
                               placeholder="Enter letter"
                               class="form-control"
                               name="letter"
                               required
                               nbInput
                               ngModel
                               #letterInput="ngModel"
                               [status]="movie.invalid ? 'danger' : 'basic'">
                      </div> -->
                      <!-- ********** START - Datos del paciente ********** -->
                      <div class="row">
                        <div class="col">
                          <nb-accordion multi>
                            <nb-accordion-item expanded="true">
                              <nb-accordion-item-header>
                                Datos paciente
                              </nb-accordion-item-header>
                              <nb-accordion-item-body>
                                <div class="row">
                                  <div class="mt-2 mb-2 col-12">
                                    <div class="card">
                                      <!-- <div class="card-header">
                                        Datos paciente
                                      </div> -->
                                      
                                      <div class="card-body">
                                        <div class="row">
                                          <!-- ********** START - Finalidad del tratamiento ********** -->
                                          <div class="col">
                                            <div style="margin-bottom: 0.5rem;">
                                              <span><i class="fas fa-user"></i>&nbsp;Primer&nbsp;nombre:&nbsp;</span><br>
                                              <h6 style="color: #000;" *ngIf="patientData?.primerNombre">{{ (patientData?.primerNombre | titlecase) }}</h6>
                                              <small *ngIf="!patientData?.primerNombre">No registra dato</small>
                                            </div>
                                            <div style="margin-bottom: 0.5rem;">
                                              <span><i class="far fa-id-card"></i>&nbsp;Tipo de documento:</span><br>
                                              <h6 style="color: #000;" *ngIf="patientData?.tipoDoc">{{ (patientData?.tipoDoc | titlecase) }}</h6>
                                              <small *ngIf="!patientData?.tipoDoc">No registra dato</small>
                                            </div>
                                          </div>
                                          <div class="col">
                                            <div style="margin-bottom: 0.5rem;">
                                              <span><i class="fas fa-user"></i>&nbsp;Segundo&nbsp;nombre:&nbsp;</span><br>
                                              <h6 style="color: #000;" *ngIf="patientData?.segundoNombre">{{ (patientData?.segundoNombre | titlecase) }}</h6>
                                              <small *ngIf="!patientData?.segundoNombre">No registra dato</small>
                                            </div>
                                            <div style="margin-bottom: 0.5rem;">
                                              <span><i class="far fa-id-card"></i>&nbsp;N&uacute;mero de documento:</span><br>
                                              <h6 style="color: #000;" *ngIf="patientData?.numeroDocumento">{{ patientData?.numeroDocumento }}</h6>
                                              <small *ngIf="!patientData?.numeroDocumento">No registra dato</small>
                                            </div>
                                          </div>
                                          <div class="col">
                                            <div style="margin-bottom: 0.5rem;">
                                              <span><i class="fas fa-user"></i>&nbsp;Primer&nbsp;apellido:&nbsp;</span><br>
                                              <h6 style="color: #000;" *ngIf="patientData?.primerApellido">{{ (patientData?.primerApellido | titlecase) }}</h6>
                                              <small *ngIf="!patientData?.primerApellido">No registra dato</small>
                                            </div>
                                            <div style="margin-bottom: 0.5rem;">
                                              <span><i class="far fa-calendar-alt"></i>&nbsp;Fecha de nacimiento:</span><br>
                                              <h6 style="color: #000;" *ngIf="patientData?.fechaNacimiento">{{ patientData?.fechaNacimiento | date:'mediumDate' }}</h6>
                                              <small *ngIf="!patientData?.fechaNacimiento">No registra dato</small>
                                            </div>
                                          </div>
                                          <div class="col">
                                            <div style="margin-bottom: 0.5rem;">
                                              <span><i class="fas fa-user"></i>&nbsp;Segundo&nbsp;apellido:&nbsp;</span><br>
                                              <h6 style="color: #000;"*ngIf="patientData?.segundoApellido">{{ (patientData?.segundoApellido | titlecase) }}</h6>
                                              <small *ngIf="!patientData?.segundoApellido">No registra dato</small>
                                            </div>
                                            <div style="margin-bottom: 0.5rem;">
                                              <span><i class="far fa-calendar-alt"></i>&nbsp;Edad:</span><br>
                                              <h6 style="color: #000;" *ngIf="patientData?.edad">{{ patientData?.edad + ' años' }}</h6>
                                              <small *ngIf="!patientData?.edad">No registra dato</small>
                                            </div>
                                          </div>
                                          <!-- *********** END - Finalidad del tratamiento *********** -->
                                          <div class="col-12">
                                            <hr>
                                          </div>
                                          <div class="col-6">
                                            <div style="margin-bottom: 0.5rem;">
                                              <span><i class="fas fa-at"></i>&nbsp;Correo electr&oacute;nico:</span>
                                              <h6 style="color: #000;" *ngIf="patientData?.email && inputEmailPatient == false">
                                                {{ patientData?.email }}&nbsp;
                                                <i class="fas fa-pencil-alt cursor-pointer" (click)="inputEmailPatient = true"></i>
                                              </h6>&nbsp;
                                              <small *ngIf="!patientData?.email">No registra dato</small>
                                              <input 
                                                *ngIf="inputEmailPatient == true"
                                                class=""
                                                nbInput
                                                fullWidth 
                                                fieldSize="large"  
                                                type="text" 
                                                [readonly]="false" 
                                                [disabled]="false" 
                                                id="input-emailPatient"  
                                                name="emailPatient" 
                                                [(ngModel)]="patientData.email" 
                                                (focusout)="inputEmailPatient = false"
                                                [status]="'info'"
                                                placeholder="Correo electronico paciente">
                                            </div>
                                          </div>
                                          <div class="col-6">
                                            <div style="margin-bottom: 0.5rem;">
                                              <span><i class="fas fa-phone-square-alt"></i>&nbsp;T&eacute;lefono:</span>
                                              <h6 style="color: #000;" *ngIf="patientData?.telefono && inputPhonePatient == false">
                                                {{ patientData?.telefono }}
                                                <i class="fas fa-pencil-alt cursor-pointer" (click)="inputPhonePatient = true"></i>
                                              </h6>
                                              <small *ngIf="!patientData?.telefono">No registra dato</small>
                                              <input 
                                                *ngIf="inputPhonePatient == true"
                                                class=""
                                                nbInput
                                                fullWidth 
                                                fieldSize="large"  
                                                type="text" 
                                                [readonly]="false" 
                                                [disabled]="false" 
                                                id="input-phonePatient"  
                                                name="phonePatient" 
                                                [(ngModel)]="patientData.telefono" 
                                                (focusout)="inputPhonePatient = false"
                                                [status]="'info'"
                                                placeholder="Número de teléfono paciente">
                                            </div>
                                          </div>
                                          <div class="col-12">
                                            <div style="margin-bottom: 0.5rem;">
                                              <span><i class="fas fa-map-marker"></i>&nbsp;Direcci&oacute;n:</span>
                                              <h6 style="color: #000;" *ngIf="patientData?.direccion && inputPhonePatient == false">
                                                {{ patientData?.direccion }}
                                                <!-- <i class="fas fa-pencil-alt cursor-pointer" (click)="inputAddressPatient = true"></i> -->
                                                <i class="fas fa-pencil-alt cursor-pointer" (click)="fnShowModalAddAddress()"></i>
                                              </h6>
                                              <small *ngIf="!patientData?.direccion">No registra dato</small>
                                              <input 
                                                *ngIf="inputAddressPatient == true"
                                                class=""
                                                nbInput
                                                fullWidth 
                                                fieldSize="large"  
                                                type="text" 
                                                [readonly]="false" 
                                                [disabled]="false" 
                                                id="input-phonePatient"  
                                                name="phonePatient" 
                                                [(ngModel)]="patientData.telefono" 
                                                (focusout)="inputAddressPatient = false"
                                                [status]="'info'"
                                                placeholder="Número de teléfono paciente">
                                            </div>
                                          </div>
                                        </div>
                                        
                                        
                                      </div>
          
                                    </div>
                                  </div>
                                </div>
                              </nb-accordion-item-body>
                            </nb-accordion-item>
                          
                            <nb-accordion-item *ngIf="false">
                              <nb-accordion-item-header>
                                Lugar de notificaci&oacute;n
                              </nb-accordion-item-header>
                              <nb-accordion-item-body>
                                <div class="row">
                                  <div class="mt-2 mb-2 col-12">

                                    <div class="card">
                                      <!-- <div class="card-header">
                                        Lugar
                                      </div> -->
                                      <div class="card-body" style="padding-bottom: 3rem;">
                                        <div class="row">
                                          <div class="col">
                                            <div class="form-group">
                                              <label for="input-patientCountry">
                                                <h5 class="m-0">
                                                  <i class="fas fa-globe-americas"></i>&nbsp;Pa&iacute;s:&nbsp;
                                                  <span class="text-danger cursor-pointer" tooltip="Campo obligatorio" placement="top" container="body">*</span>
                                                </h5>
                                              </label>
                                              <ng-select 
                                                [items]="collectionCountries" 
                                                bindLabel="name"
                                                id="input-patientCountry" 
                                                name="patientCountry" 
                                                #patientCountryCRHB="ngModel"
                                                placeholder="Seleccione país" 
                                                [ngModelOptions]="{standalone: true}" 
                                                [(ngModel)]="patientCountry"
                                                required 
                                                [disabled]="false" 
                                                [clearable]="false">
                                              </ng-select>
                                            </div>
                                          </div>
                                          <div class="col">
                                            <div class="form-group">
                                              <label for="input-patientDepartament">
                                                <h5 class="m-0">
                                                  <i class="fas fa-map-marked-alt"></i>&nbsp;Departamento:&nbsp;
                                                  <span class="text-danger cursor-pointer" tooltip="Campo obligatorio" placement="top" container="body">*</span>
                                                </h5>
                                              </label>
                                              <ng-select 
                                                [items]="collectionDepartaments" 
                                                bindLabel="departamento"
                                                id="input-patientDepartament" 
                                                name="patientDepartament" 
                                                #patientDepartamentC="ngModel"
                                                placeholder="Seleccione departamento" 
                                                [ngModelOptions]="{standalone: true}" 
                                                [(ngModel)]="patientDepartament"
                                                (change)="fnSetPatientCityCondition($event)"
                                                required 
                                                [disabled]="(patientCountry)?.length < 1 || collectionDepartaments.length < 1" 
                                                [clearable]="false">
                                              </ng-select>
                                            </div>
                                          </div>
                                          <div class="col">
                                            <div class="form-group">
                                              <label for="input-patientCity">
                                                <h5 class="m-0">
                                                  <i class="fas fa-map-marker-alt"></i>&nbsp;Ciudad:&nbsp;
                                                  <span class="text-danger cursor-pointer" tooltip="Campo obligatorio" placement="top" container="body">*</span>
                                                </h5>
                                              </label>
                                              <ng-select 
                                                [items]="collectionCities" 
                                                bindLabel="name"
                                                id="input-patientCity" 
                                                name="patientCity" 
                                                #patientCityC="ngModel"
                                                placeholder="Seleccione ciudad" 
                                                [ngModelOptions]="{standalone: true}" 
                                                [(ngModel)]="patientCity"
                                                required 
                                                [disabled]="(patientDepartament)?.length < 1 || collectionCities.length < 1" 
                                                [clearable]="false">
                                              </ng-select>
                                            </div>
                                          </div>
                                          <div class="col-12">
                                            <div class="form-group">
                                              <label for="input-patientAddressCondition">
                                                <h5 class="m-0">
                                                  <i class="fas fa-house-user"></i>&nbsp;Direcci&oacute;n:&nbsp;
                                                  <span class="cursor-pointer text-optional-field" tooltip="Campo opcional" placement="top" container="body">(Opcional)</span>
                                                </h5>
                                              </label>
                                              <div class="row">
                                                <div class="col-2">
                                                  <ng-select 
                                                    [items]="collectionWayType" 
                                                    bindLabel="name"
                                                    id="input-patientAddressWayType" 
                                                    name="patientAddressWayType" 
                                                    #patientAddressWayTypeC="ngModel"
                                                    placeholder="Seleccione tipo via" 
                                                    [ngModelOptions]="{standalone: true}" 
                                                    [(ngModel)]="patientAddressWayType"
                                                    (change)="fnBuildAddress($event)"
                                                    required 
                                                    [disabled]="false" 
                                                    [clearable]="false">
                                                  </ng-select>
                                                </div>
                                                <div class="col-1">
                                                  <input 
                                                    class=""
                                                    nbInput
                                                    fullWidth 
                                                    fieldSize="large"  
                                                    type="text" 
                                                    [readonly]="false" 
                                                    [disabled]="false" 
                                                    placeholder="Ingrese el número tipo via"
                                                    id="input-patientAddressFirstNumber"  
                                                    name="patientAddressFirstNumber" 
                                                    (change)="fnBuildAddress($event)"
                                                    [(ngModel)]="patientAddressFirstNumber" 
                                                    [ngModelOptions]="{standalone: true}"
                                                    [status]="patientAddressFirstNumberC.dirty ? (patientAddressFirstNumberC.invalid  ? 'danger' : 'basic') : 'basic'" 
                                                    #patientAddressFirstNumberC="ngModel">
                                                </div>
                                                <div class="col-1">
                                                  <ng-select 
                                                    [items]="collectionLetters" 
                                                    bindLabel="name"
                                                    id="input-patientAddressFirstLetter" 
                                                    name="patientAddressFirstLetter" 
                                                    #patientAddressFirstLetterC="ngModel"
                                                    placeholder="Seleccione letra de número de via" 
                                                    [ngModelOptions]="{standalone: true}" 
                                                    [(ngModel)]="patientAddressFirstLetter"
                                                    required 
                                                    (change)="fnBuildAddress($event)"
                                                    [disabled]="false" 
                                                    [clearable]="false">
                                                  </ng-select>
                                                </div>
                                                <div class="col-1">
                                                  <ng-select 
                                                    [items]="collectionBis" 
                                                    bindLabel="name"
                                                    id="input-patientAddressSufixBis" 
                                                    name="patientAddressSufixBis" 
                                                    #patientAddressSufixBisC="ngModel"
                                                    placeholder="Seleccione letra de número de via" 
                                                    [ngModelOptions]="{standalone: true}" 
                                                    [(ngModel)]="patientAddressSufixBis"
                                                    required 
                                                    (change)="fnBuildAddress($event)"
                                                    [disabled]="false" 
                                                    [clearable]="false">
                                                  </ng-select>
                                                </div>
                                                <div class="col-1">
                                                  <ng-select 
                                                    [items]="collectionLetters" 
                                                    bindLabel="name"
                                                    id="input-patientAddressSecondLetter" 
                                                    name="patientAddressSecondLetter" 
                                                    #patientAddressSecondLetterC="ngModel"
                                                    placeholder="Seleccione letra de número de via" 
                                                    [ngModelOptions]="{standalone: true}" 
                                                    [(ngModel)]="patientAddressSecondLetter"
                                                    required 
                                                    (change)="fnBuildAddress($event)"
                                                    [disabled]="false" 
                                                    [clearable]="false">
                                                  </ng-select>
                                                </div>
                                                <div class="col-1">
                                                  <ng-select 
                                                    [items]="collectionCardinalSufix" 
                                                    bindLabel="name"
                                                    id="input-patientAddressFirstCardinalSufix" 
                                                    name="patientAddressFirstCardinalSufix" 
                                                    #patientAddressFirstCardinalSufixC="ngModel"
                                                    placeholder="Seleccione sufijo cardinal" 
                                                    [ngModelOptions]="{standalone: true}" 
                                                    [(ngModel)]="patientAddressFirstCardinalSufix"
                                                    required 
                                                    (change)="fnBuildAddress($event)"
                                                    [disabled]="false" 
                                                    [clearable]="false">
                                                  </ng-select>
                                                </div>
                                                <div class="col-1 text-center p-0" style="max-width: 30px !important;">
                                                  <h3 style="margin: 10px 0px;">#</h3>
                                                </div>
                                                <div class="col-1">
                                                  <input 
                                                    class=""
                                                    nbInput
                                                    fullWidth 
                                                    fieldSize="large"  
                                                    type="text" 
                                                    [readonly]="false" 
                                                    [disabled]="false" 
                                                    placeholder="Ingrese el número tipo via"
                                                    id="input-patientAddressSecondNumber"  
                                                    name="patientAddressSecondNumber" 
                                                    [(ngModel)]="patientAddressSecondNumber" 
                                                    [ngModelOptions]="{standalone: true}"
                                                    [status]="patientAddressSecondNumberC.dirty ? (patientAddressSecondNumberC.invalid  ? 'danger' : 'basic') : 'basic'" 
                                                    (change)="fnBuildAddress($event)"
                                                    #patientAddressSecondNumberC="ngModel">
                                                </div>
                                                <div class="col-1">
                                                  <ng-select 
                                                    [items]="collectionLetters" 
                                                    bindLabel="name"
                                                    id="input-patientAddressThirdLetter" 
                                                    name="patientAddressThirdLetter" 
                                                    #patientAddressThirdLetterC="ngModel"
                                                    placeholder="Seleccione letra de número de via" 
                                                    [ngModelOptions]="{standalone: true}" 
                                                    [(ngModel)]="patientAddressThirdLetter"
                                                    required 
                                                    (change)="fnBuildAddress($event)"
                                                    [disabled]="false" 
                                                    [clearable]="false">
                                                  </ng-select>
                                                </div>
                                                <div class="col-1 text-center p-0" style="max-width: 30px !important;">
                                                  <h3 style="margin: 10px 0px;">-</h3>
                                                </div>
                                                <div class="col-1">
                                                  <input 
                                                    class=""
                                                    nbInput
                                                    fullWidth 
                                                    fieldSize="large"  
                                                    type="text" 
                                                    [readonly]="false" 
                                                    [disabled]="false" 
                                                    placeholder="Ingrese el número tipo via"
                                                    id="input-patientAddressThirdNumber"  
                                                    name="patientAddressThirdNumber" 
                                                    (change)="fnBuildAddress($event)"
                                                    [(ngModel)]="patientAddressThirdNumber" 
                                                    [ngModelOptions]="{standalone: true}"
                                                    [status]="patientAddressThirdNumberC.dirty ? (patientAddressThirdNumberC.invalid  ? 'danger' : 'basic') : 'basic'" 
                                                    #patientAddressThirdNumberC="ngModel">
                                                </div>
                                                <div class="col-1">
                                                  <ng-select 
                                                    [items]="collectionCardinalSufix" 
                                                    bindLabel="name"
                                                    id="input-patientAddressSecondCardinalSufix" 
                                                    name="patientAddressSecondCardinalSufix" 
                                                    #patientAddressSecondCardinalSufixC="ngModel"
                                                    placeholder="Seleccione sufijo cardinal" 
                                                    [ngModelOptions]="{standalone: true}" 
                                                    [(ngModel)]="patientAddressSecondCardinalSufix"
                                                    required 
                                                    (change)="fnBuildAddress($event)"
                                                    [disabled]="false" 
                                                    [clearable]="false">
                                                  </ng-select>
                                                </div>
                                              </div>
                                              <div class="row">
                                                <div class="col-12 mt-3 mb-2">
                                                  <label for="input-addresPlace">
                                                    <small class="m-0 cursor-pointer" (click)="fnShowContent('listAddresPlace')">
                                                      <i class="fas fa-chevron-right"></i>&nbsp;Direcci&oacute;n generada:&nbsp;
                                                    </small>
                                                  </label>
                                                  <div class="listAddresPlace m-2" style="display: block;">
                                                    <div class="m-2 d-flex justify-content-between" style="border-radius: 5px; font-size: .9em; color: #000; padding: 5px; font-weight: 400;">
                                                      <h4>
                                                        {{ addressPlaceBuilded | uppercase }}
                                                      </h4>
                                                    </div>
                                                  </div>
                                                </div>
                                              </div>
                                              <!-- <input 
                                                class=""
                                                nbInput
                                                fullWidth 
                                                fieldSize="large"  
                                                type="text" 
                                                [readonly]="false" 
                                                [disabled]="false" 
                                                placeholder="Ingrese la dirección paciente"
                                                id="input-patientAddressCondition"  
                                                name="patientAddressCondition" 
                                                (focus)="patientData.diagnostic.patientAddressCondition = '';"
                                                [(ngModel)]="patientData.diagnostic.patientAddressCondition" 
                                                [ngModelOptions]="{standalone: true}"
                                                [status]="patientAddressCondition.dirty ? (patientAddressCondition.invalid  ? 'danger' : 'basic') : 'basic'" 
                                                #patientAddressCondition="ngModel"> -->
                                            </div>
                                          </div>
                                          <div class="col-12">
                                            <div class="form-group">
                                              <label for="input-patientAddressPlaceCondition">
                                                <h5 class="m-0">
                                                  <i class="fas fa-map-pin"></i>&nbsp;<small>(Barrio, Municipio, Vereda):</small>&nbsp;
                                                  <span class="cursor-pointer text-optional-field" tooltip="Campo opcional" placement="top" container="body">(Opcional)</span>
                                                </h5>
                                              </label>
                                              <input 
                                                class=""
                                                nbInput
                                                fullWidth 
                                                fieldSize="large"  
                                                type="text" 
                                                [readonly]="false" 
                                                [disabled]="false" 
                                                placeholder="Seleccione fecha de inicio"
                                                id="input-patientAddressPlaceCondition"  
                                                name="patientAddressPlaceCondition" 
                                                (input)="fnBuildAddress($event)"
                                                [(ngModel)]="patientAddressPlaceCondition" 
                                                [ngModelOptions]="{standalone: true}"
                                                [status]="patientAddressPlaceConditionC.dirty ? (patientAddressPlaceConditionC.invalid  ? 'danger' : 'basic') : 'basic'" 
                                                #patientAddressPlaceConditionC="ngModel">
                                            </div>
                                          </div>

                                        </div>
                                      </div>
                                    </div>

                                  </div>
                                </div>
                              </nb-accordion-item-body>
                            </nb-accordion-item>
                          
                            <nb-accordion-item expanded="true">
                              <nb-accordion-item-header>
                                Datos empleador(es)
                              </nb-accordion-item-header>
                              <nb-accordion-item-body>

                                <ngx-patient-employer-list 
                                  *ngIf="patientData"
                                  [idPaciente]="patientData?.iIDPaciente" 
                                  [patientData]="patientData" 
                                  [documentNumber]="patientData?.numeroDocumento" 
                                  [documentType]="patientData?.iIDTipoDoc" 
                                  [collectionEmployers]="null" 
                                  [typeList]="1"
                                ></ngx-patient-employer-list>

                              </nb-accordion-item-body>
                            </nb-accordion-item>
                          </nb-accordion>
                        </div>
                      </div>                    
                      <div class="row mt-4">
                        <div class="col">
                          <div class="mb-4 pb-4 animated fadeIn d-flex justify-content-center align-items-center">
                            <button 
                              nbButton 
                              class="cursor-pointer" 
                              nbStepperPrevious 
                              shape="round" 
                              size="small" 
                              status="info"
                              [disabled]="false">Anterior
                            </button>
                            &nbsp;
                            <button 
                              nbButton 
                              class="cursor-pointer" 
                              shape="round" 
                              size="small" 
                              status="info" 
                              (click)="fnShoewPreviewCRHB()" 
                              [disabled]="false">
                              <i class="fas fa-eye"></i>&nbsp;
                              Vista preliminar
                            </button>
                            &nbsp;
                            <button 
                              nbButton 
                              class="cursor-pointer" 
                              shape="round" 
                              size="small" 
                              status="info" 
                              (click)="fnUpdateConcept()" 
                              [disabled]="false">Guardar
                            </button>
                            &nbsp;
                            <button 
                              nbButton 
                              class="cursor-pointer" 
                              nbStepperNext 
                              shape="round" 
                              size="small" 
                              status="info" 
                              (click)="fnEmmitConcept()"
                              [disabled]="false">Emitir
                            </button>
                          </div>
                        </div>
                      </div>
                    </form>
                  </nb-step>

                  <nb-step [hidden]="true">
                    <div class="step-container text-center mt-4">
                      <h3>Concepto emitido satisfactoriamente!</h3>
                      <button 
                        nbButton 
                        class="cursor-pointer" 
                        shape="round" 
                        size="small" 
                        status="info" 
                        (click)="fnReturnListCases()"
                        [disabled]="false">Regresar al listado de casos
                      </button>
                    </div>
                  </nb-step>

                </nb-stepper>

              </div>
            </div>

            <!-- <pre>
              {{ patientData.diagnostic | json }}
            </pre> -->

          </nb-card-body>
        </nb-card>
      </nb-card-front>
      <nb-card-back>
        <nb-card>
          <nb-card-header>
            <div class="row m-0 p-0">
              <div class="col text-left">
                <button type="button" (click)="fnReturnPage()" class="btn btn-link text-info cursor-pointer">
                  <i class="fas fa-arrow-left"></i>&nbsp;{{ 'Regresar' | titlecase }}
                </button>
              </div>
              <div class="col text-center">
                <h3 style="margin-top: 6px;">Grafico de incapacidades</h3>
              </div>
              <div class="col text-right">
                <button type="button" (click)="fnViewHistory()" class="btn btn-link text-info cursor-pointer">
                  {{ 'Ver historico' | titlecase }}&nbsp;
                  <i class="fas fa-list"></i>
                </button>
              </div>
            </div> 
            
            <!-- <span class=" mt-2 mb-3">
              <i class="fas fa-arrow-left"></i>&nbsp;Regresar
            </span> -->
            
          </nb-card-header>
          <nb-card-body>
            <div>
              Paciente: 
              <h4><strong>
                {{ patientData?.primerNombre | titlecase }} 
                {{ patientData?.segundoNombre | titlecase | titlecase }} 
                {{ patientData?.primerApellido | titlecase }} 
                {{ patientData?.tSegundoApellido | titlecase }} 
              </strong></h4>
            </div>
            <p class="mb-4">
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Repellat voluptas molestiae, rem, consequuntur dolorem quibusdam ex error sapiente facere quo, harum inventore quod voluptatibus hic! Repellat nobis architecto aperiam sit.
            </p>
            <div class="row">
              
              
            </div>
          </nb-card-body>
        </nb-card>
      </nb-card-back>
    </nb-flip-card>

  </div>
</div>